# 文章生成多样性优化

## 问题分析

通过分析 `articles.json` 发现以下问题：
1. **重复标题**：存在完全相同的标题
2. **分类不平衡**：健康护理类文章过多（7篇）
3. **标题模式单一**：缺乏多样性

## 优化措施

### 1. 增强防重复机制

#### 改进话题跟踪系统
- 从简单的列表改为结构化数据
- 同时跟踪：话题、标题、分类计数
- 避免无限递归，设置最大尝试次数

```python
# 新的数据结构
{
    "topics": ["已使用的话题列表"],
    "titles": ["已使用的标题列表"], 
    "categories": {"分类": 计数}
}
```

#### 分类平衡机制
- 当某个分类已有3篇以上文章时，降低选择概率
- 确保各分类文章数量相对均衡

### 2. 增加标题模板多样性

#### 品种介绍类（8个模板）
- 原有4个模板 + 新增4个模板
- 新增：饲养全攻略、品种秘密、适合性分析、专业解读

#### 幼猫护理类（8个模板）
- 原有4个模板 + 新增4个模板
- 新增：全攻略、必读指南、详解、实用技巧

#### 用品测评类（8个模板）
- 原有4个模板 + 新增4个模板
- 新增：购买攻略、排行榜、选购全攻略、深度解析

#### 健康护理类（8个模板）
- 原有4个模板 + 新增4个模板
- 新增：完全指南、护理手册、应对策略、专业解读

#### 行为训练类（8个模板）
- 原有4个模板 + 新增4个模板
- 新增：行为矫正、训练指南、专业解析、问题解决手册

### 3. 新增营养饮食分类

#### 新增分类特点
- **分类名称**：营养饮食
- **图标**：🍽️
- **8个标题模板**：涵盖不同营养元素
- **营养主题**：蛋白质、维生素、矿物质、脂肪、碳水化合物、水分、膳食纤维、益生菌

#### 内容结构
1. 营养需求分析
2. 食材选择要点
3. 喂养时间安排
4. 营养搭配原则
5. 常见问题解答
6. 注意事项提醒
7. 专家建议总结

### 4. 备用生成机制

当常规模板无法生成合适文章时，使用备用模板：
- 猫咪日常护理小贴士
- 新手养猫必备知识
- 猫咪用品选购指南

## 技术实现

### 防重复逻辑
```python
def generate_article_idea(self) -> Dict:
    max_attempts = 50  # 避免无限递归
    while attempts < max_attempts:
        # 生成候选文章
        if (topic_key not in used_topics["topics"] and 
            title not in used_topics["titles"] and
            check_category_balance(category)):
            return article_idea
        attempts += 1
    return fallback_idea()
```

### 分类平衡检查
```python
def _check_category_balance(self, category: str) -> bool:
    current_count = category_counts.get(category, 0)
    if current_count >= 3:
        return random.random() > 0.7  # 30%概率仍选择
    return True
```

## 预期效果

### 多样性提升
- **标题模板**：从20个增加到48个（+140%）
- **分类数量**：从5个增加到6个（+20%）
- **防重复机制**：更严格的重复检测

### 内容质量
- **分类平衡**：避免某个分类过度集中
- **标题创新**：更多样化的表达方式
- **营养专题**：填补营养饮食内容空白

### 用户体验
- **内容丰富**：涵盖更多养猫知识领域
- **阅读体验**：避免重复内容
- **SEO优化**：更多样化的关键词覆盖

## 监控建议

1. **定期检查**：每周分析文章多样性
2. **分类平衡**：确保各分类文章数量均衡
3. **标题创新**：避免标题模式过于单一
4. **内容质量**：确保新增分类内容质量

## 回滚方案

如需回滚，可以：
1. 恢复原有的简单话题跟踪机制
2. 减少标题模板数量
3. 移除营养饮食分类
4. 调整分类平衡参数 