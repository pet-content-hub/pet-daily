import{v as W,r as w,c as M,x as I,_ as E,o as G,a as l,i,e as k,f as c,b as a,t as U,F as b,m as _,y as T,g as O,z as V,n as j,u as J,d as H,k as z}from"./main-CcXaIEdh.js";const R=W("user",()=>{const u=w(null),t=w(!1),s=w(!1),f=w(null),y=M(()=>u.value?u.value.nickName||u.value.uid||"用户":"未登录"),m=M(()=>u.value&&u.value.avatarUrl||null);async function g(){try{if(s.value=!0,I.isLoggedIn()){const n=I.getCurrentUser();n&&(u.value=n,t.value=!0)}I.onAuthStateChanged(n=>{n?(u.value=n.user,t.value=!0,console.log("用户已登录:",n.user)):(u.value=null,t.value=!1,console.log("用户已退出"))})}catch(n){console.error("初始化用户认证失败:",n),f.value=n.message}finally{s.value=!1}}async function C(){try{s.value=!0,f.value=null;const n=await I.signInAnonymously();return u.value=n.user,t.value=!0,n}catch(n){throw console.error("匿名登录失败:",n),f.value=n.message,n}finally{s.value=!1}}async function L(){try{s.value=!0,f.value=null;const n=await I.signInWithWechat();return u.value=n.user,t.value=!0,n}catch(n){throw console.error("微信登录失败:",n),f.value=n.message,n}finally{s.value=!1}}async function A(){try{s.value=!0,f.value=null,await I.signOut(),u.value=null,t.value=!1}catch(n){throw console.error("退出登录失败:",n),f.value=n.message,n}finally{s.value=!1}}function S(){f.value=null}return{user:u,isLoggedIn:t,isLoading:s,error:f,userDisplayName:y,userAvatar:m,initAuth:g,signInAnonymously:C,signInWithWechat:L,signOut:A,clearError:S}}),K={class:"user-auth"},q={key:0,class:"user-profile"},Q={class:"user-info"},X=["src","alt"],Y={key:1,class:"user-avatar-placeholder"},Z={class:"user-name"},ee=["disabled"],se={key:1,class:"login-options"},te=["disabled"],ae=["disabled"],oe={key:2,class:"error-message"},ne={__name:"UserAuth",setup(u){const t=R();G(()=>{t.initAuth()});async function s(){try{await t.signInAnonymously()}catch(m){console.error("匿名登录失败:",m)}}async function f(){try{await t.signInWithWechat()}catch(m){console.error("微信登录失败:",m)}}async function y(){try{await t.signOut()}catch(m){console.error("退出登录失败:",m)}}return(m,g)=>(i(),l("div",K,[c(t).isLoggedIn?(i(),l("div",q,[a("div",Q,[c(t).userAvatar?(i(),l("img",{key:0,src:c(t).userAvatar,alt:c(t).userDisplayName,class:"user-avatar"},null,8,X)):(i(),l("div",Y,U(c(t).userDisplayName.charAt(0)),1)),a("span",Z,U(c(t).userDisplayName),1)]),a("button",{onClick:y,class:"btn btn-outline",disabled:c(t).isLoading},[c(t).isLoading?(i(),l(b,{key:0},[g[1]||(g[1]=a("span",{class:"loading-spinner"},null,-1)),g[2]||(g[2]=_(" 退出中... ",-1))],64)):(i(),l(b,{key:1},[_(" 退出登录 ")],64))],8,ee)])):(i(),l("div",se,[a("button",{onClick:s,class:"btn btn-primary",disabled:c(t).isLoading},[c(t).isLoading?(i(),l(b,{key:0},[g[3]||(g[3]=a("span",{class:"loading-spinner"},null,-1)),g[4]||(g[4]=_(" 登录中... ",-1))],64)):(i(),l(b,{key:1},[_(" 匿名登录 ")],64))],8,te),a("button",{onClick:f,class:"btn btn-success",disabled:c(t).isLoading}," 微信登录 ",8,ae)])),c(t).error?(i(),l("div",oe,[_(U(c(t).error)+" ",1),a("button",{onClick:g[0]||(g[0]=(...C)=>c(t).clearError&&c(t).clearError(...C)),class:"error-close"},"×")])):k("",!0)]))}},re=E(ne,[["__scopeId","data-v-f3467ae4"]]),le=W("upload",()=>{const u=w(new Map),t=w(!1),s=w(null),f=M(()=>u.value.size),y=M(()=>Array.from(u.value.values()).some(d=>d.status==="uploading"));function m(){return Date.now()+"_"+Math.random().toString(36).substr(2,9)}function g(d,v){const o=m(),e={id:o,file:d,path:v,status:"pending",progress:0,result:null,error:null,createdAt:new Date};return u.value.set(o,e),o}async function C(d,v=null){if(!d)throw new Error("文件不能为空");if(!["image/jpeg","image/png","image/gif","image/webp"].includes(d.type))throw new Error("只支持 JPEG, PNG, GIF, WebP 格式的图片");const e=5*1024*1024;if(d.size>e)throw new Error("文件大小不能超过 5MB");const p=Date.now(),r=d.name.split(".").pop()||"jpg",h=`${p}_${Math.random().toString(36).substr(2,9)}.${r}`,F=v||`images/${h}`,P=g(d,F),$=u.value.get(P);try{$.status="uploading",$.progress=0,t.value=!0,s.value=null;const D=await I.uploadImage(d,F);return $.status="success",$.progress=100,$.result=D,console.log("图片上传成功:",D),{uploadId:P,result:D,task:$}}catch(D){throw $.status="error",$.error=D.message,s.value=D.message,console.error("图片上传失败:",D),D}finally{t.value=y.value}}async function L(d){try{return await I.getDownloadURL(d)}catch(v){throw console.error("获取图片下载链接失败:",v),s.value=v.message,v}}async function A(d){try{const v=await I.deleteFile(d);return console.log("图片删除成功:",v),v}catch(v){throw console.error("删除图片失败:",v),s.value=v.message,v}}function S(d){return u.value.get(d)}function n(d){return u.value.delete(d)}function N(){const d=["success","error"];for(const[v,o]of u.value)d.includes(o.status)&&u.value.delete(v)}function x(){s.value=null}async function B(d,v=null){const o=[];for(const e of d){const p=v?`${v}/${Date.now()}_${Math.random().toString(36).substr(2,9)}.${e.name.split(".").pop()}`:null;o.push(C(e,p))}try{const e=await Promise.allSettled(o),p=e.filter(h=>h.status==="fulfilled").map(h=>h.value),r=e.filter(h=>h.status==="rejected").map(h=>h.reason);return{successful:p,failed:r,total:d.length}}catch(e){throw console.error("批量上传失败:",e),e}}return{uploads:u,isUploading:t,error:s,uploadCount:f,hasActiveUploads:y,uploadImage:C,uploadMultipleImages:B,getImageDownloadURL:L,deleteImage:A,getUploadTask:S,removeUploadTask:n,clearCompletedTasks:N,clearError:x}}),ie={class:"image-upload"},ce={class:"upload-content"},ue={key:0,class:"upload-text"},de={key:1,class:"upload-text disabled-text"},ve={key:0,class:"upload-tasks"},pe={class:"task-info"},fe={class:"file-name"},ge={class:"file-size"},me={class:"task-status"},he={key:0,class:"progress-bar"},ye=["onClick"],_e={key:0,class:"task-result"},we={class:"result-actions"},ke=["onClick"],Ie=["onClick"],be=["onClick"],Ce={key:1,class:"task-error"},$e={class:"task-actions"},De={key:1,class:"error-message"},Ue=["src"],Le={__name:"ImageUpload",setup(u){const t=R(),s=le(),f=w(null),y=w(!1),m=w(null);G(()=>{t.initAuth()});function g(){var o;t.isLoggedIn&&((o=f.value)==null||o.click())}function C(o){const e=Array.from(o.target.files);e.length>0&&n(e),o.target.value=""}function L(o){if(o.preventDefault(),y.value=!1,!t.isLoggedIn)return;const e=Array.from(o.dataTransfer.files).filter(p=>p.type.startsWith("image/"));e.length>0&&n(e)}function A(o){o.preventDefault(),t.isLoggedIn&&(y.value=!0)}function S(o){o.preventDefault(),y.value=!1}async function n(o){for(const e of o)try{await s.uploadImage(e)}catch(p){console.error("上传失败:",p)}}function N(o){if(o===0)return"0 B";const e=1024,p=["B","KB","MB","GB"],r=Math.floor(Math.log(o)/Math.log(e));return parseFloat((o/Math.pow(e,r)).toFixed(2))+" "+p[r]}async function x(o){try{if(o.fileID){const e=await s.getImageDownloadURL(o.fileID);await navigator.clipboard.writeText(e),alert("图片链接已复制到剪贴板")}}catch(e){console.error("复制链接失败:",e),alert("复制链接失败: "+e.message)}}async function B(o){try{o.fileID&&(m.value=await s.getImageDownloadURL(o.fileID))}catch(e){console.error("预览失败:",e),alert("预览失败: "+e.message)}}async function d(o){if(confirm("确定要删除这张图片吗？"))try{await s.deleteImage(o.fileID),alert("图片删除成功")}catch(e){console.error("删除失败:",e),alert("删除失败: "+e.message)}}function v(){m.value=null}return(o,e)=>(i(),l("div",ie,[a("div",{class:T(["upload-zone",{"drag-over":y.value,disabled:!c(t).isLoggedIn}]),onDrop:L,onDragover:A,onDragleave:S,onClick:g},[a("input",{ref_key:"fileInput",ref:f,type:"file",multiple:"",accept:"image/jpeg,image/png,image/gif,image/webp",onChange:C,style:{display:"none"}},null,544),a("div",ce,[e[3]||(e[3]=a("div",{class:"upload-icon"},"📁",-1)),c(t).isLoggedIn?(i(),l("p",ue," 点击或拖拽图片到此处上传 ")):(i(),l("p",de," 请先登录后再上传图片 ")),e[4]||(e[4]=a("p",{class:"upload-hint"}," 支持 JPEG、PNG、GIF、WebP 格式，单个文件不超过 5MB ",-1))])],34),c(s).uploadCount>0?(i(),l("div",ve,[e[5]||(e[5]=a("h4",null,"上传任务",-1)),(i(!0),l(b,null,O(c(s).uploads,([p,r])=>(i(),l("div",{key:p,class:"upload-task"},[a("div",pe,[a("span",fe,U(r.file.name),1),a("span",ge,"("+U(N(r.file.size))+")",1)]),a("div",me,[r.status==="uploading"?(i(),l("div",he,[a("div",{class:"progress-fill",style:V({width:r.progress+"%"})},null,4)])):k("",!0),a("div",{class:T(["status-badge","status-"+r.status])},[r.status==="pending"?(i(),l(b,{key:0},[_("等待中")],64)):r.status==="uploading"?(i(),l(b,{key:1},[_(" 上传中 "+U(r.progress)+"% ",1)],64)):r.status==="success"?(i(),l(b,{key:2},[_("✅ 完成")],64)):r.status==="error"?(i(),l(b,{key:3},[_("❌ 失败")],64)):k("",!0)],2),r.status==="success"||r.status==="error"?(i(),l("button",{key:1,onClick:h=>c(s).removeUploadTask(p),class:"remove-task"}," × ",8,ye)):k("",!0)]),r.status==="success"&&r.result?(i(),l("div",_e,[a("div",we,[a("button",{onClick:h=>x(r.result),class:"btn-copy"}," 复制链接 ",8,ke),a("button",{onClick:h=>B(r.result),class:"btn-preview"}," 预览 ",8,Ie),a("button",{onClick:h=>d(r.result),class:"btn-delete"}," 删除 ",8,be)])])):k("",!0),r.status==="error"&&r.error?(i(),l("div",Ce,U(r.error),1)):k("",!0)]))),128)),a("div",$e,[a("button",{onClick:e[0]||(e[0]=(...p)=>c(s).clearCompletedTasks&&c(s).clearCompletedTasks(...p)),class:"btn btn-outline"}," 清除已完成 ")])])):k("",!0),c(s).error?(i(),l("div",De,[_(U(c(s).error)+" ",1),a("button",{onClick:e[1]||(e[1]=(...p)=>c(s).clearError&&c(s).clearError(...p)),class:"error-close"},"×")])):k("",!0),m.value?(i(),l("div",{key:2,class:"image-preview-modal",onClick:v},[a("div",{class:"preview-content",onClick:e[2]||(e[2]=j(()=>{},["stop"]))},[a("img",{src:m.value,alt:"预览图片",class:"preview-image"},null,8,Ue),a("button",{onClick:v,class:"close-preview"},"×")])])):k("",!0)]))}},Ae=E(Le,[["__scopeId","data-v-2fafad22"]]),Se={class:"upload-page"},Me={class:"container"},Ne={class:"auth-section"},xe={class:"upload-section"},Be={__name:"Upload",setup(u){return J({title:"图片上传 - 猫咪世界",meta:[{name:"description",content:"安全便捷的图片上传服务，支持多种格式，腾讯云存储，实时预览和分享"},{name:"keywords",content:"图片上传,云存储,腾讯云,CloudBase,图片分享"},{property:"og:title",content:"图片上传 - 猫咪世界"},{property:"og:description",content:"安全便捷的图片上传服务，支持多种格式，腾讯云存储"},{property:"og:type",content:"website"}]}),(t,s)=>(i(),l("div",Se,[a("div",Me,[s[2]||(s[2]=a("div",{class:"page-header"},[a("h1",null,"图片上传"),a("p",{class:"page-description"}," 上传和管理您的图片，支持多种格式，安全可靠的云存储 ")],-1)),a("div",Ne,[s[0]||(s[0]=a("h2",null,"用户登录",-1)),z(re)]),a("div",xe,[s[1]||(s[1]=a("h2",null,"图片上传",-1)),z(Ae)]),s[3]||(s[3]=H('<div class="instructions" data-v-a773fc0c><h3 data-v-a773fc0c>使用说明</h3><div class="instruction-grid" data-v-a773fc0c><div class="instruction-item" data-v-a773fc0c><div class="instruction-icon" data-v-a773fc0c>🔐</div><h4 data-v-a773fc0c>登录认证</h4><p data-v-a773fc0c>使用匿名登录或微信登录来开始上传图片</p></div><div class="instruction-item" data-v-a773fc0c><div class="instruction-icon" data-v-a773fc0c>📁</div><h4 data-v-a773fc0c>上传图片</h4><p data-v-a773fc0c>支持拖拽或点击选择多张图片，格式：JPEG、PNG、GIF、WebP</p></div><div class="instruction-item" data-v-a773fc0c><div class="instruction-icon" data-v-a773fc0c>☁️</div><h4 data-v-a773fc0c>云端存储</h4><p data-v-a773fc0c>图片安全存储在腾讯云，单个文件最大 5MB</p></div><div class="instruction-item" data-v-a773fc0c><div class="instruction-icon" data-v-a773fc0c>🔗</div><h4 data-v-a773fc0c>链接分享</h4><p data-v-a773fc0c>上传成功后可复制链接、预览图片或删除文件</p></div></div></div><div class="tech-info" data-v-a773fc0c><h3 data-v-a773fc0c>技术特性</h3><ul data-v-a773fc0c><li data-v-a773fc0c>✅ 腾讯云 CloudBase 云存储</li><li data-v-a773fc0c>✅ 支持多文件并发上传</li><li data-v-a773fc0c>✅ 实时上传进度显示</li><li data-v-a773fc0c>✅ 图片预览和链接复制</li><li data-v-a773fc0c>✅ 安全的用户认证</li><li data-v-a773fc0c>✅ 移动端适配</li></ul></div>',2))])]))}},Fe=E(Be,[["__scopeId","data-v-a773fc0c"]]);export{Fe as default};
